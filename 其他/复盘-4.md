# 项目复盘-Redis

## 背景
在日志平台的系统中，也用到了redis作为缓存。主要有三个用途令牌桶限流、session和配置缓存

## 令牌桶限流
### 使用场景
在项目中，为了支持别的业务导出日志做别的分析，提供了导出方案，为了防止请求数量过高，所以使用令牌桶来限流。

### 原理
原理：令牌桶算法是一种基于令牌的限流算法，它维护一个固定容量的令牌桶，按照固定速率往桶中添加令牌，每当有请求到来时，消耗一个令牌，如果桶中没有足够的令牌，则拒绝该请求。

### 具体实现方法
将redis作为保存令牌得容器，当第一次请求到达时，会先在redis中创建一个令牌桶。然后会从桶中取出一个令牌，令牌数目减一。当后面的请求到达时，会先往令牌桶中放入时间间隔*每秒应该放入量。然后判断是否令牌数目够，从而判断是否执行业务逻辑

## session保存
利用redis保存session主要是为了保存登陆状态，以方便分布式应用都保证登陆状态

## 配置缓存
### 场景
日志采集的工作是由端上的agent实现，但是对于agent来说，需要一定得配置启动，但是这个配置可能一直在变，因此将其写到redis

### 具体实现
为了控制并发加上版本控制，所以选择版本+redis得方式来控制。对于每个配置内容都会有一个版本号，通过版本号实现一个类乐观锁，当写入的版本号低于当前版本号时，就不写入