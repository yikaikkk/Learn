# 复盘一下另一个项目用到的高可用相关

## 背景
服务的定位是一个基础服务，主要是一个权限系统，总共接入了400左右个系统，峰值qps也在10000+，主要用到的存储是mysql，而整个系统涉及到主链路，为了系统保证高可用，复盘一下涉及到可用性相关的技术

## 负载均衡

### 七层负载均衡
项目挂载在公司的服务注册中心上，有一个服务名，公司的名字服务类似于DNS，七层负载均衡，服务名解析出的vip是第一次负载均衡，在第一次负载均衡中，优先按照最近的解析，减少网络的消耗。

### 四层负均衡
vip相当于一层流量转发层，流量打到vip:80端口上，后续通过负载均衡策略对请求，一般的负载均衡策略有轮询，最小连接数，加权轮询

基于vip的负载均衡一般通过LVS集群实现

第一层：负载调度器：Load Balancer，它是访问整个群集系统的唯一入口，对外使用所有服务器共有的虚拟 IP 地址，也成为群集 IP 地址。

负载均衡器：是服务器群集系统的单个入口点，可运行 IPVS，该 IPVS 在 Linux 内核或 KTCPVS 内部实现 IP 负载均衡技术，在 Linux 内核中实现应用程序级负载平衡。使用 IPVS 时，要求所有服务器提供相同的服务和内容，负载均衡器根据指定的调度算法和每个服务器的负载将新的客户端请求转发到服务器。无论选择哪个服务器，客户端都应获得相同的结果。使用 KTCPVS 时，服务器可以具有不同的内容，负载均衡器可以根据请求的内容将请求转发到其他服务器。由于 KTCPVS 是在 Linux 内核内部实现的，因此中继数据的开销很小，因此仍可以具有较高的吞吐量。

第二层：服务器池：Server Pool，群集所提供的应用服务，比如：HTTP、FTP服务器池来承担，每个节点具有独立的真实 IP 地址，只处理调度器分发过来的客户机请求。

服务器群集的节点可根据系统所承受的负载进行分担。当所有服务器过载时，可添加多台服务器来处理不断增加的工作负载。对于大多数 Internet 服务（例如Web），请求通常没有高度关联，并且可以在不同服务器上并行运行。因此，随着服务器群集的节点数增加，整体性能几乎可以线性扩展。


## 读写分离

### mysql集群读写分离
mysql 集群采用多节点，一主三从一备的方式构建集群
