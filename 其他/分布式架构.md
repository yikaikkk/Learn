# 微服务架构

## 背景
最近在思考做的项目的定位，结合项目的属性，即专注于单一的职责，不同服务之间通过消息队列异步通信或者API进行通信，并且不同项目之间的依赖性小，做的项目应该是微服务架构中的一些服务。

## 微服务架构的定义

微服务架构是一种将大型应用程序分解为一组小型、独立且可独立部署的服务的方法。 每个服务都专注于特定的业务功能，并能独立开发、测试和更新。 它们通过API（如REST）相互通信，这种架构可以提高灵活性、可扩展性和维护性，尤其适合构建云原生应用。 

微服务架构的关键特征

    模块化拆分： 将复杂的应用拆分为多个更小的、专注于单一职责的服务。 

    独立部署： 每个微服务都可以独立于其他服务进行部署和更新，而无需重新部署整个应用程序。

    技术多样性： 不同服务可以使用不同的编程语言、数据库和其他技术栈，以最适合其特定功能。 

    松散耦合： 服务之间的依赖性最小，并通过明确定义的接口（如API）进行通信，从而避免级联故障。 

    自动化： 依赖自动化工具进行持续交付和部署，以便快速响应需求变化。 

优势

    提高敏捷性和开发速度： 小团队可以并行开发不同的服务，缩短开发周期。 

    更好的可扩展性： 可以根据需求独立扩展单个微服务，而不是整个应用程序，从而更有效地利用资源。 

    易于维护和更新： 当需要修改一个功能时，只需要更新和部署相关的微服务，降低了风险。 

    故障隔离： 如果一个微服务发生故障，不会导致整个应用程序瘫痪。 

缺点

    增加复杂性：: 架构本身变得更复杂，需要更多的管理和协调工作。 

    分布式系统挑战：: 需要处理分布式系统固有的挑战，如网络延迟、数据一致性等。 

    测试复杂性：: 端到端的测试变得更加复杂。 

|组件类型|核心作用|	典型技术 / 工具|
|-------|------|---------------|
|服务注册与发现|	服务启动后注册到注册中心，调用方自动发现服务地址（无需硬编码 IP）。|	Nacos、Eureka、Consul、ZooKeeper
|API 网关|	统一入口，处理路由、认证、限流、监控等横切逻辑（如将/api/user/*路由到用户服务）。|	Spring Cloud Gateway、Zuul、Kong
|服务通信	|服务间调用方式：同步（即时响应）或异步（解耦削峰）。	|同步：Dubbo、gRPC、Feign；异步：RabbitMQ、Kafka、RocketMQ
|服务治理	|保障服务稳定性：熔断（服务故障时快速失败）、降级（高负载时返回简化结果）、限流（限制请求量）。	|Sentinel、Hystrix、Resilience4j
|分布式事务|	保证跨服务操作的原子性（如 “下单” 需同时调用订单服务和支付服务，要么全成功，要么全回滚）。	|Seata（AT/TCC 模式）、SAGA 模式
|配置中心|	集中管理所有服务的配置（如数据库密码、限流阈值），支持动态更新。	|Nacos、Apollo、Spring Cloud Config
|链路追踪|	追踪请求在多个服务间的调用路径，定位性能瓶颈或错误（如 “下单超时” 是哪个服务耗时过长）。|	SkyWalking、Zipkin、Jaeger
|监控告警	|收集服务的运行指标（CPU、接口 QPS、错误率），异常时告警。|	Prometheus + Grafana、ELK Stack

## 具体实现
### 服务注册与发现	
在具体项目中，服务的注册中心使用的公司内部的BNS，对于每个服务都可以使用BNS注册，得到一个服务名，其他服务可以通过这个BNS来访问这个服务。这个服务名下面会挂在多台机器，在访问到达时，BNS系统会按照负载均衡策略将请求发送到不同的实例上。

### 扩展性
扩容和缩容都是在服务名上对机器进行扩容或者缩容，对于其他服务是无感。

### 可用性
一个服务名存在多个服务实例，当一个实例宕机以后，流量会被发送到正常的机器上，不会影响功能。