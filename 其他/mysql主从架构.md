# mysql主从架构

## 背景
在项目中为了保证项目的高性能和高可用性，对数据采用了一主多从一备的方案

## mysql主从架构的优势
1、数据备份

​给主服务增加一个数据备份。基于这个目的，可以搭建主从架构，或者也可以基于主从架构搭建互主的架构。

2、读写分离

​对于大部分的JAVA业务系统来说，都是读多写少的，读请求远远高于写请求。这时，当主服务的访问压力过大时，可以将数据读请求转为由从服务来分担，主服务只负责数据写入的请求，这样大大缓解数据库的访问压力。

对于项目的请求都是通过代理的方式打到负载均衡组件上，在通过负载均衡组件按照请求的不同方式判断到主节点还是从节点

3、故障转移-高可用

​当MySQL主服务宕机后，可以由一台从服务切换成为主服务，继续提供数据读写功能。

​对于高可用架构，主从数据的同步也只是实现故障转移的一个前提条件，要实现MySQL主从切换，还需要依靠一些其他的中间件来实现。比如MMM、MHA、MGR。

​在一般项目中，如果数据库的访问压力没有那么大，那读写分离不一定是必须要做的，但是，主从架构和高可用架构则是必须要搭建的。

## 原理
MySQL服务的主从架构一般都是通过binlog日志文件来进行的。即在主服务上打开binlog记录每一步的数据库操作，然后从服务上会有一个IO线程，负责跟主服务建立一个TCP连接，请求主服务将binlog传输过来。这时，主库上会有一个IO dump线程，负责通过这个TCP连接把Binlog日志传输给从库的IO线程。接着从服务的IO线程会把读取到的binlog日志数据写入自己的relay日志文件中。然后从服务上另外一个SQL线程会读取relay日志里的内容，进行操作重演，达到还原数据的目的。我们通常对MySQL做的读写分离配置就必须基于主从架构来搭建。

除了mysql自身的数据同步模式，还有其他的DTS方式，比如maxwell或者canal也能通过解析binlog的方式，对mysql数据进行同步

## 一些问题
主从延迟，之前遇到过一次[mysql主从延迟](http://115.190.50.228:8083/articles/162)