# 记一次sql调优过程
## 背景
在最近的一次开发过程中，有一个需求，需要写一个openapi给其他部门调用。这个接口是一个鉴权接口，整个系统采用RBAC的模型，同时包含继承逻辑，因此在查询权限时需要对多张表进行查询

## 第一次开发
在第一次开发时在查询用户的直接绑定角色和继承的角色时，选择了联表查询，将组继承表和用户表联合查询，得到用户的继承角色。

## 性能问题
将mysql中的数据量级用户角色表和角色表量级到10w+时，在压测时，qps只能到50左右，通过explain查看每个sql都走了索引的情况下。选择查看每个sql的执行时间，发现这个联合查询的执行很慢，排查发现是大表联合查询导致的性能损耗。

## 总结
当参与 Join 的表数据量较大时，查询需要处理的记录数会急剧增加，导致性能下降。
优化方式：
减少 Join 表的大小，对大表进行分区，减少单次查询的数据量。