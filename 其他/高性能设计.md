# 用到的高性能设计复盘

## 连接池和链接复用
在sdk和子进程通信和子进程和后端通信时，都使用了连接池。

### 优势
1、性能

在通信时可以复用同一个长连接，减少建立连接的时间。例如，如果每次请求都去新建一个链接，如果是tcp，每次都会经历链接建立和销毁，从而导致时间延迟。

同时，防止当并发过高时，消耗过多的文件描述符，避免链接风暴，从而导致更多的资源浪费。

## 缓存
对于部分需要用到的数据，子进程提前缓存到内存里，减少网络通信带来的时间延迟

## 原子操作
1、对于更新的数据，使用原子操作进行更新，使用无锁方式，避免因为锁带来的损耗

2、采用无锁队列记录日志，避免因为锁带来的损耗

## 异步操作
1、对于定时获取数据，采用单独的协程进行操作。

2、在记录日志时，使用单独的协程进行操作，防止阻塞

## 批量处理
对于日志记录，需要聚合上报到后台，在处理时，并不是一条一条上报，而是选择批量上报，减少网络通信带来的损耗