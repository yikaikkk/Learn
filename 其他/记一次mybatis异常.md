# 记一次分页引起的mybatis异常
最近在写一个接口时，由于查询比较复杂，没有选择mybatisplus提供的封装好的接口，选择在xml中使用sql语句查询。
由于最后的结果需要分页返回，所以同时传入了一个page对象。在运行过程中的日志中发现，抛出了许多exception，但是不影响业务逻辑。后续在网上搜索发现是sql中的部分原因导致mybatis优化异常

## 为什么会发生异常？
* SQL 语句复杂：分页插件在生成 COUNT(*) SQL 时，会试图简化查询，但如果原SQL过于复杂（如包含子查询、多重连接等），简化失败就会导致异常。

* 索引缺失：查询条件字段上缺少索引，会导致 COUNT(*) 语句性能低下或无法正确执行，从而触发异常。

* 数据库特性：某些数据库特性或版本可能对 COUNT(*) 语句的优化支持不佳，导致插件无法正确解析或生成优化后的SQL。

## 如何处理异常？
* 优化 COUNT(*) SQL：
简化你的查询：:检查原始的查询语句，移除不必要的复杂性，特别是避免冗余的子查询和不必要的连接。

* 添加索引：确保 WHERE 子句中使用的所有字段都已创建了合适的索引。

* 跳过 COUNT(*) 优化：
如果你确定不需要精确的 COUNT(*) 来进行物理分页，或者原SQL 无法被插件正确优化，可以通过配置Mybatis 分页插件（如Mybatis-Plus 的 PaginationInterceptor）来跳过 COUNT(*) 的优化。但请注意，这可能会影响分页的准确性。

* 调整分页策略：

* 使用物理分页：确保你使用的是数据库级别的物理分页，而不是在内存中进行逻辑分页。

* 考虑游标分页：对于非常大的数据集，传统的 OFFSET/FETCH 分页可能效率不高，考虑使用数据库游标进行分页。

* 考虑缓存或异步加载:如果是热点数据且不常变动，可以考虑将分页结果缓存起来，或异步加载分页数据，以提高性能