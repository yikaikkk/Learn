# 用户注册

注册流程主要包含以下步骤：
* 1.发送验证码 → 2. 提交注册信息 → 3. 验证信息 → 4. 创建用户数据

## 发送验证码
验证码采用随机生成，将邮件内容存入到消息队列，将验证码存入到redis，设置过期时间

接口
URL：GET /users/code
参数：username（邮箱地址）
限流：注解限制同一IP每60秒只能发送1次

### 实现逻辑

1、验证邮箱格式是否正确

2、生成6位随机验证码
```java
public static String getRandomCode() {
    StringBuilder str = new StringBuilder();
    Random random = new Random();
    for (int i = 0; i < 6; i++) {
        str.append(random.nextInt(10));
    }
    return str.toString();
}
```
3、构造邮件内容并通过RabbitMQ异步发送

4、将验证码存储到Redis中，键为code:邮箱地址，15分钟后过期


##  用户注册

接口

URL：POST /users/register

参数：UserVO对象（包含username、password、code）

实现逻辑

参数验证：

邮箱格式验证

密码长度不少于6位

验证码不能为空

验证码校验逻辑
```java
private Boolean checkUser(UserVO user) {
    // 从Redis中获取存储的验证码进行比对
    if (!user.getCode().equals(redisService.get(USER_CODE_KEY + user.getUsername()))) {
        throw new BizException("验证码错误！");
    }
    // 检查邮箱是否已被注册
    UserAuth userAuth = userAuthMapper.selectOne(new LambdaQueryWrapper<UserAuth>()
            .select(UserAuth::getUsername)
            .eq(UserAuth::getUsername, user.getUsername()));
    return Objects.nonNull(userAuth);
}
```
用户信息创建：

创建UserInfo记录（包含邮箱、昵称、头像等）

创建UserRole关联记录（默认分配USER角色）

创建UserAuth记录（包含用户名、加密密码、登录类型等）

密码加密：

使用BCrypt对用户密码进行加密存储

```java
password(BCrypt.hashpw(userVO.getPassword(), BCrypt.gensalt()))
```

